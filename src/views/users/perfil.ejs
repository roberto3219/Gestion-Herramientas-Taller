<!DOCTYPE html>
<html lang="es">
<%- include('../partials/head.ejs') %>
<body>
<%- include('../partials/header') %>
  <div class="container mt-4">
    <h2>Perfil del Usuario</h2>

    <!-- Informaci칩n -->
    <div class="card p-3">
      <p><strong>Nombre:</strong> <%= usuario.nombre %></p>
      <p><strong>Email:</strong> <%= usuario.email %></p>
      <p><strong>Rol:</strong> <%= usuario.role_id == 1 ? "Administrador" : "Usuario" %></p>
    </div>

    <!-- Botones -->
    <div class="mt-3" style="display: flex; gap: 10px;flex-wrap: wrap;justify-content: center;">
        <form action="/users/profile" method="post">
            <input type="submit" value="Cerrar Sesi칩n" class="btn btn-danger">
        </form>
        <button class="btn btn-dark" id="btnTogglePassword">Cambiar Contrase침a</button>
        <a  class="btn btn-info" href="#" id="btnEditarPerfil">Editar Perfil</a>
        <form action="/users/backup" method="post">
            <input type="submit" value="Copia de Seguridad(JSON)" class="btn btn-success">
        </form>
        <form action="" method="post">
            <input type="submit" value="Restaurar Copia de Seguridad(JSON)" class="btn btn-primary">
        </form>
        <button class="btn btn-dark" id="btnGenerarPDF">Generar PDFs</button>
    </div>

    <!-- 游댳 Formulario oculto para cambiar contrase침a -->
    <div id="formPassword" class="card p-3 mt-3" style="display:none; max-width: 500px; margin:auto;">
      <h5>Cambiar Contrase침a</h5>
      <form action="/users/change-password" method="post">
        <div class="mb-3">
          <% if (error != undefined) {%>
          <div class="alert alert-danger"><%= error %></div>
          <% } %>
            <label for="currentPassword" class="form-label">Contrase침a actual</label>
          <input type="password" name="currentPassword" id="currentPassword" class="form-control" required>
        </div>
        <div class="mb-3">
          <label for="newPassword" class="form-label">Nueva contrase침a</label>
          <input type="password" name="newPassword" id="newPassword" class="form-control" required>
        </div>
        <div class="mb-3">
          <label for="confirmPassword" class="form-label">Confirmar nueva contrase침a</label>
          <input type="password" name="confirmPassword" id="confirmPassword" class="form-control" required>
        </div>
        <button type="submit" class="btn btn-primary">Guardar cambios</button>
      </form>
    </div>
    
    <div id="formEditarPerfil" style="display:none; margin-top:20px;">
      <form action="/users/edit" method="post" class="card p-3">
        <h5>Editar Perfil</h5>
        <div class="mb-3">
          <label for="nombre" class="form-label">Nombre</label>
          <input type="text" class="form-control" id="nombre" name="nombre" value="<%= usuario.nombre %>" required>
        </div>
        <div class="mb-3">
          <label for="email" class="form-label">Correo Electr칩nico</label>
          <input type="email" class="form-control" id="email" name="email" value="<%= usuario.email %>" required>
        </div>
        <button type="submit" class="btn btn-primary">Guardar Cambios</button>
      </form>
    </div>

  </div>
  <script src="/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="/js/perfil.js"></script>
</body>
</html>
